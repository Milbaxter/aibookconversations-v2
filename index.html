<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Book Conversations ‚Äî Learn Something New Every Day</title>
  <meta name="description" content="AI-powered voice conversations about the world's greatest books. 2 new books every week. Your personal book expert explains the key ideas and discusses them with you.">
  <meta property="og:title" content="AI Book Conversations ‚Äî Talk to Any Book">
  <meta property="og:description" content="AI-powered voice conversations about the world's greatest books. Pick a book, start talking.">
  <meta property="og:url" content="https://aibookconversations.com/">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://aibookconversations.com/og-image.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://aibookconversations.com/og-image.jpg">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Nunito+Sans:opsz,wght@6..12,400;6..12,500;6..12,600;6..12,700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-deep: #0c0a07;
      --bg: #12100d;
      --bg-surface: #1a1714;
      --bg-card: #211e18;
      --bg-card-hover: #2d2920;
      --accent: #c8a24e;
      --accent-light: #dbb85c;
      --accent-dim: rgba(200,162,78,0.15);
      --text: #ede7d9;
      --text-sec: #9e9484;
      --text-muted: #6a6256;
      --border: rgba(200,162,78,0.12);
      --border-strong: rgba(200,162,78,0.25);
      --green: #7eb563;
      --red: #e74c3c;
    }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Nunito Sans', sans-serif;
      background: var(--bg-deep); color: var(--text);
      line-height: 1.7; -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }
    body::after {
      content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 10000; opacity: 0.02;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
      background-size: 256px;
    }
    h1, h2, h3 { font-family: 'Cormorant Garamond', serif; }
    a { color: var(--accent); }

    /* ===== PROGRESS BAR ===== */
    #progress-bar {
      position: fixed; top: 0; left: 0; right: 0; height: 4px;
      background: var(--bg-surface); z-index: 200; display: none;
    }
    #progress-fill {
      height: 100%; width: 0; background: var(--accent);
      transition: width 0.5s cubic-bezier(0.4,0,0.2,1);
    }

    /* ===== SCREENS ===== */
    .screen {
      display: none; min-height: 100vh; min-height: 100dvh;
      flex-direction: column; align-items: center; justify-content: center;
      padding: 80px 24px 60px; position: relative;
    }
    .screen.active { display: flex; animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    .screen-inner { max-width: 600px; width: 100%; text-align: center; }

    /* ===== LANDING ===== */
    .landing { padding: 0; }
    .landing-hero {
      min-height: 100vh; min-height: 100dvh; display: flex; align-items: center;
      justify-content: center; text-align: center; padding: 60px 24px; position: relative;
    }
    .landing-hero::before {
      content: ''; position: absolute; width: 700px; height: 700px; border-radius: 50%;
      background: radial-gradient(circle, rgba(200,162,78,0.07) 0%, transparent 70%);
      top: 50%; left: 50%; transform: translate(-50%,-55%);
      animation: pulse 6s ease-in-out infinite;
    }
    @keyframes pulse { 0%,100%{opacity:.5;transform:translate(-50%,-55%) scale(1)} 50%{opacity:1;transform:translate(-50%,-55%) scale(1.15)} }
    .landing-content { position: relative; z-index: 1; max-width: 660px; }
    .landing h1 { font-size: 3.6rem; font-weight: 600; line-height: 1.12; letter-spacing: -1px; margin-bottom: 20px; }
    .landing h1 em { font-style: italic; color: var(--accent); }
    .landing .sub { font-size: 1.15rem; color: var(--text-sec); max-width: 480px; margin: 0 auto 36px; line-height: 1.7; }
    .btn {
      display: inline-block; background: var(--accent); color: var(--bg-deep);
      padding: 16px 44px; border-radius: 10px; text-decoration: none;
      font-size: 1.08rem; font-weight: 700; border: none; cursor: pointer;
      font-family: inherit; transition: all 0.25s; letter-spacing: 0.3px;
    }
    .btn:hover { background: var(--accent-light); transform: translateY(-1px); }
    .btn-outline {
      background: transparent; border: 2px solid var(--accent); color: var(--accent);
    }
    .btn-outline:hover { background: var(--accent); color: var(--bg-deep); }
    .btn-ghost { background: transparent; color: var(--text-sec); padding: 12px 24px; font-size: 0.92rem; }
    .btn-ghost:hover { color: var(--text); }

    /* Social proof */
    .social-proof {
      padding: 80px 24px; text-align: center; border-top: 1px solid var(--border);
      background: var(--bg);
    }
    .proof-stats { display: flex; justify-content: center; gap: 48px; margin-bottom: 40px; flex-wrap: wrap; }
    .proof-stat .num { font-family: 'Cormorant Garamond',serif; font-size: 2.4rem; font-weight: 700; color: var(--accent); }
    .proof-stat .label { font-size: 0.85rem; color: var(--text-muted); }
    .proof-quote {
      max-width: 520px; margin: 0 auto; font-size: 1.1rem; font-style: italic;
      color: var(--text-sec); line-height: 1.7;
    }
    .proof-quote .attr { font-style: normal; font-size: 0.88rem; color: var(--text-muted); margin-top: 8px; }

    /* ===== QUIZ COMMON ===== */
    .q-label {
      font-size: 0.82rem; font-weight: 700; text-transform: uppercase;
      letter-spacing: 2px; color: var(--accent); margin-bottom: 16px;
    }
    .q-title {
      font-family: 'Cormorant Garamond', serif; font-size: 2rem;
      font-weight: 600; margin-bottom: 32px; line-height: 1.3;
    }

    /* Choice cards */
    .choices { display: grid; gap: 12px; width: 100%; }
    .choices.cols-2 { grid-template-columns: 1fr 1fr; }
    .choices.cols-3 { grid-template-columns: 1fr 1fr 1fr; }
    .choice {
      background: var(--bg-card); border: 2px solid var(--border);
      border-radius: 12px; padding: 18px 20px; cursor: pointer;
      transition: all 0.25s; user-select: none; text-align: center;
    }
    .choice:hover { border-color: var(--border-strong); transform: translateY(-2px); }
    .choice.selected { border-color: var(--accent); background: var(--accent-dim); }
    .choice .ch-icon { font-size: 1.6rem; display: block; margin-bottom: 8px; }
    .choice .ch-text { font-weight: 600; font-size: 0.92rem; }
    .choice .ch-sub { font-size: 0.8rem; color: var(--text-muted); margin-top: 4px; }
    .choice.multi .ch-check {
      display: none; font-size: 0.75rem; color: var(--accent); margin-top: 6px;
    }
    .choice.multi.selected .ch-check { display: block; }

    /* Agree/Disagree scale */
    .scale-wrap { margin-bottom: 8px; }
    .scale-labels { display: flex; justify-content: space-between; margin-bottom: 10px; }
    .scale-labels span { font-size: 0.8rem; color: var(--text-muted); }
    .scale-row { display: flex; justify-content: center; gap: 16px; }
    .scale-btn {
      width: 52px; height: 52px; border-radius: 50%; border: 2px solid var(--border);
      background: transparent; color: var(--text-muted); font-weight: 700;
      font-size: 0.88rem; cursor: pointer; transition: all 0.25s; font-family: inherit;
    }
    .scale-btn:hover { border-color: var(--border-strong); color: var(--text); }
    .scale-btn.selected { border-color: var(--accent); background: var(--accent); color: var(--bg-deep); }

    /* Reaction message */
    .reaction {
      display: none; margin-top: 28px; padding: 20px 24px;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 12px; text-align: left;
    }
    .reaction.show { display: block; animation: fadeIn 0.4s ease; }
    .reaction .r-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 6px; color: var(--accent); }
    .reaction .r-text { font-size: 0.9rem; color: var(--text-sec); line-height: 1.6; }
    .continue-btn {
      display: none; margin-top: 20px;
    }
    .continue-btn.show { display: inline-block; }

    /* ===== BOOK SELECTION ===== */
    .book-swipe { position: relative; width: 100%; max-width: 400px; margin: 0 auto; }
    .book-cover {
      background: var(--bg-card); border: 2px solid var(--border); border-radius: 16px;
      padding: 40px 28px; text-align: center; min-height: 260px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .book-cover .bc-num { font-size: 0.78rem; color: var(--text-muted); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1.5px; }
    .book-cover .bc-title { font-family: 'Cormorant Garamond',serif; font-size: 1.8rem; font-weight: 600; margin-bottom: 8px; }
    .book-cover .bc-author { font-size: 0.92rem; color: var(--text-sec); margin-bottom: 12px; }
    .book-cover .bc-sub { font-size: 0.85rem; color: var(--text-muted); font-style: italic; }
    .vote-row { display: flex; justify-content: center; gap: 24px; margin-top: 24px; }
    .vote-btn {
      width: 64px; height: 64px; border-radius: 50%; border: 2px solid var(--border);
      background: var(--bg-card); font-size: 1.5rem; cursor: pointer;
      transition: all 0.25s; display: flex; align-items: center; justify-content: center;
    }
    .vote-btn:hover { transform: scale(1.1); }
    .vote-btn.down:hover { border-color: var(--red); background: rgba(231,76,60,0.1); }
    .vote-btn.up:hover { border-color: var(--green); background: rgba(126,181,99,0.1); }

    /* ===== LOADING ===== */
    .loading-bar-wrap {
      width: 100%; max-width: 400px; height: 8px; background: var(--bg-card);
      border-radius: 8px; margin: 32px auto; overflow: hidden;
    }
    .loading-bar-fill {
      height: 100%; width: 0; background: var(--accent); border-radius: 8px;
      transition: width 0.5s ease;
    }
    .loading-text { font-size: 0.92rem; color: var(--text-sec); min-height: 28px; }
    .bonus-q { display: none; margin-top: 32px; }
    .bonus-q.show { display: block; animation: fadeIn 0.4s ease; }

    /* ===== EMAIL CAPTURE ===== */
    .email-form { max-width: 400px; width: 100%; margin: 0 auto; }
    .email-form input {
      width: 100%; padding: 16px 20px; border-radius: 10px;
      border: 2px solid var(--border); background: var(--bg-card);
      color: var(--text); font-size: 1rem; font-family: inherit;
      outline: none; transition: border-color 0.2s; margin-bottom: 14px;
    }
    .email-form input:focus { border-color: var(--accent); }
    .email-form .btn { width: 100%; text-align: center; }
    .trust-badges { display: flex; justify-content: center; gap: 20px; margin-top: 28px; flex-wrap: wrap; }
    .badge {
      display: flex; align-items: center; gap: 6px; font-size: 0.78rem;
      color: var(--text-muted); font-weight: 600;
    }
    .badge .b-icon { font-size: 1rem; }

    /* ===== PAYWALL ===== */
    .paywall { background: var(--bg); }
    .pw-timer {
      position: absolute; top: 20px; right: 24px;
      display: flex; align-items: center; gap: 8px;
      font-size: 0.82rem; color: var(--red); font-weight: 700;
    }
    .pw-timer .t-badge {
      background: rgba(231,76,60,0.12); padding: 4px 10px;
      border-radius: 6px; font-family: 'Cormorant Garamond',serif; font-size: 1.1rem;
    }
    .pw-close {
      position: absolute; top: 20px; left: 24px;
      background: none; border: none; color: var(--text-muted); font-size: 1.4rem;
      cursor: pointer; padding: 4px 8px; transition: color 0.2s;
    }
    .pw-close:hover { color: var(--text); }
    .plan-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; width: 100%; max-width: 560px; margin: 0 auto 24px; }
    .plan-card {
      background: var(--bg-surface); border: 2px solid var(--border);
      border-radius: 16px; padding: 28px 20px; text-align: center;
      cursor: pointer; transition: all 0.25s; position: relative;
    }
    .plan-card:hover { border-color: var(--border-strong); }
    .plan-card.selected { border-color: var(--accent); }
    .plan-card .pop-tag {
      position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
      background: var(--accent); color: var(--bg-deep); padding: 3px 14px;
      border-radius: 12px; font-size: 0.72rem; font-weight: 700; white-space: nowrap;
    }
    .plan-card .pc-name { font-weight: 700; font-size: 0.95rem; margin-bottom: 4px; }
    .plan-card .pc-price { font-family:'Cormorant Garamond',serif; font-size: 2.6rem; font-weight: 700; }
    .plan-card .pc-period { font-size: 0.82rem; color: var(--text-muted); }
    .plan-card .pc-orig { font-size: 0.82rem; color: var(--text-muted); margin-top: 4px; }
    .plan-card .pc-orig .strike { text-decoration: line-through; }
    .plan-card .pc-daily { font-size: 0.85rem; color: var(--accent); font-weight: 600; margin-top: 8px; }
    .pw-features {
      list-style: none; text-align: left; max-width: 400px;
      margin: 0 auto 28px; font-size: 0.88rem; color: var(--text-sec);
    }
    .pw-features li { padding: 4px 0; }
    .pw-features li::before { content: '‚úì '; color: var(--accent); font-weight: 700; }

    /* Fallback paywall */
    .trial-timeline {
      max-width: 380px; margin: 28px auto; text-align: left;
    }
    .tl-item {
      display: flex; gap: 16px; padding: 14px 0;
      border-bottom: 1px solid var(--border);
    }
    .tl-item:last-child { border-bottom: none; }
    .tl-day { font-weight: 700; color: var(--accent); font-size: 0.85rem; min-width: 60px; }
    .tl-text { font-size: 0.88rem; color: var(--text-sec); }

    /* FAQ inside fallback */
    .mini-faq { max-width: 480px; margin: 32px auto; text-align: left; }
    .mf-item { border-bottom: 1px solid var(--border); }
    .mf-item:first-child { border-top: 1px solid var(--border); }
    .mf-q {
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 0; cursor: pointer; user-select: none;
      font-weight: 700; font-size: 0.92rem;
    }
    .mf-q .arr { color: var(--text-muted); transition: transform 0.3s; font-size: 0.8rem; }
    .mf-q.open .arr { transform: rotate(180deg); }
    .mf-a { display: none; padding: 0 0 16px; font-size: 0.88rem; color: var(--text-sec); line-height: 1.7; }
    .mf-a.open { display: block; }

    /* ===== WELCOME ===== */
    .welcome-plan { max-width: 480px; width: 100%; margin: 24px auto 0; text-align: left; }
    .wp-item {
      display: flex; align-items: center; gap: 14px; padding: 16px;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 12px; margin-bottom: 10px;
    }
    .wp-item .wp-icon { font-size: 1.3rem; }
    .wp-item .wp-text { font-size: 0.92rem; }
    .wp-item .wp-text strong { color: var(--accent); }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 640px) {
      .landing h1 { font-size: 2.4rem; }
      .q-title { font-size: 1.6rem; }
      .choices.cols-3 { grid-template-columns: 1fr 1fr; }
      .scale-btn { width: 44px; height: 44px; font-size: 0.82rem; }
      .scale-row { gap: 10px; }
      .plan-cards { grid-template-columns: 1fr; }
      .proof-stats { gap: 32px; }
      .screen { padding: 70px 20px 40px; }
    }
    @media (max-width: 400px) {
      .landing h1 { font-size: 2rem; }
      .choices.cols-2 { grid-template-columns: 1fr; }
      .choices.cols-3 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<div id="progress-bar"><div id="progress-fill"></div></div>

<!-- ===== SCREEN 0: LANDING ===== -->
<div class="screen landing active" data-step="0">
  <div class="landing-hero">
    <div class="landing-content">
      <h1>Learn Something <em>New</em> Every Day</h1>
      <p class="sub">Get the key ideas from the world's greatest books in 20-minute AI voice conversations. 2 new books every week.</p>
      <button class="btn" onclick="startQuiz()">Get Started</button>
      <p style="font-size:0.82rem;color:var(--text-muted);margin-top:14px;">Takes less than 3 minutes</p>
    </div>
  </div>
  <div class="social-proof">
    <div class="proof-stats">
      <div class="proof-stat"><div class="num">60+</div><div class="label">Book conversations</div></div>
      <div class="proof-stat"><div class="num">6</div><div class="label">Genres</div></div>
      <div class="proof-stat"><div class="num">20 min</div><div class="label">Deep-dive sessions</div></div>
    </div>
    <div class="proof-quote">
      "A mind needs books as a sword needs a whetstone, if it is to keep its edge."
      <div class="attr">‚Äî George R.R. Martin</div>
    </div>
  </div>
</div>

<!-- ===== SCREEN 1: GENDER ===== -->
<div class="screen" data-step="1">
  <div class="screen-inner">
    <p class="q-label">About You</p>
    <h2 class="q-title">What is your age?</h2>
    <div class="choices cols-2" id="q-age">
      <div class="choice" onclick="selectSingle('age','18-24',this)">
        <span class="ch-icon">üå±</span><span class="ch-text">18‚Äì24</span>
      </div>
      <div class="choice" onclick="selectSingle('age','25-34',this)">
        <span class="ch-icon">üöÄ</span><span class="ch-text">25‚Äì34</span>
      </div>
      <div class="choice" onclick="selectSingle('age','35-44',this)">
        <span class="ch-icon">‚ö°</span><span class="ch-text">35‚Äì44</span>
      </div>
      <div class="choice" onclick="selectSingle('age','45+',this)">
        <span class="ch-icon">üèõÔ∏è</span><span class="ch-text">45+</span>
      </div>
    </div>
  </div>
</div>

<!-- ===== SCREEN 2: GROWTH AREAS ===== -->
<div class="screen" data-step="2">
  <div class="screen-inner">
    <p class="q-label">Your Goals</p>
    <h2 class="q-title">Which areas do you want to grow in?</h2>
    <p style="font-size:0.88rem;color:var(--text-muted);margin-top:-20px;margin-bottom:28px;">Select all that apply</p>
    <div class="choices cols-2" id="q-growth">
      <div class="choice multi" onclick="toggleMulti('growth','productive',this)">
        <span class="ch-icon">‚ö°</span><span class="ch-text">Be more productive</span><span class="ch-check">‚úì</span>
      </div>
      <div class="choice multi" onclick="toggleMulti('growth','habits',this)">
        <span class="ch-icon">üîÑ</span><span class="ch-text">Build lasting habits</span><span class="ch-check">‚úì</span>
      </div>
      <div class="choice multi" onclick="toggleMulti('growth','finances',this)">
        <span class="ch-icon">üí∞</span><span class="ch-text">Boost finances &amp; career</span><span class="ch-check">‚úì</span>
      </div>
      <div class="choice multi" onclick="toggleMulti('growth','relationships',this)">
        <span class="ch-icon">üí¨</span><span class="ch-text">Improve relationships</span><span class="ch-check">‚úì</span>
      </div>
      <div class="choice multi" onclick="toggleMulti('growth','wellbeing',this)">
        <span class="ch-icon">üßò</span><span class="ch-text">Improve my well-being</span><span class="ch-check">‚úì</span>
      </div>
      <div class="choice multi" onclick="toggleMulti('growth','browsing',this)">
        <span class="ch-icon">üëÄ</span><span class="ch-text">I'm just browsing</span><span class="ch-check">‚úì</span>
      </div>
    </div>
    <button class="btn continue-btn" id="growth-continue" onclick="advanceStep()" style="margin-top:24px;">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 3: BIG PICTURE VS DETAILS ===== -->
<div class="screen" data-step="3">
  <div class="screen-inner">
    <p class="q-label">How You Think</p>
    <h2 class="q-title">Do you tend to focus more on the broader picture or finer details?</h2>
    <div class="choices" id="q-focus">
      <div class="choice" onclick="selectWithReaction('focus','big',this)">
        <span class="ch-icon">üî≠</span><span class="ch-text">The broader picture</span>
      </div>
      <div class="choice" onclick="selectWithReaction('focus','detail',this)">
        <span class="ch-icon">üîç</span><span class="ch-text">Finer details</span>
      </div>
      <div class="choice" onclick="selectWithReaction('focus','both',this)">
        <span class="ch-icon">‚öñÔ∏è</span><span class="ch-text">Both equally</span>
      </div>
    </div>
    <div class="reaction" id="reaction-3"></div>
    <button class="btn continue-btn" id="continue-3" onclick="advanceStep()">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 4: KNOW WHAT YOU WANT ===== -->
<div class="screen" data-step="4">
  <div class="screen-inner">
    <p class="q-label">Self-Awareness</p>
    <h2 class="q-title">"You know what you want."</h2>
    <div class="scale-wrap">
      <div class="scale-labels"><span>Disagree</span><span>Agree</span></div>
      <div class="scale-row" id="q-goals">
        <button class="scale-btn" onclick="selectScale('goals',1,this)">1</button>
        <button class="scale-btn" onclick="selectScale('goals',2,this)">2</button>
        <button class="scale-btn" onclick="selectScale('goals',3,this)">3</button>
        <button class="scale-btn" onclick="selectScale('goals',4,this)">4</button>
        <button class="scale-btn" onclick="selectScale('goals',5,this)">5</button>
      </div>
    </div>
    <div class="reaction" id="reaction-4"></div>
    <button class="btn continue-btn" id="continue-4" onclick="advanceStep()">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 5: SELF-DOUBT ===== -->
<div class="screen" data-step="5">
  <div class="screen-inner">
    <p class="q-label">Resilience</p>
    <h2 class="q-title">"I often doubt myself and my abilities when I make a mistake."</h2>
    <div class="scale-wrap">
      <div class="scale-labels"><span>Disagree</span><span>Agree</span></div>
      <div class="scale-row" id="q-doubt">
        <button class="scale-btn" onclick="selectScale('doubt',1,this)">1</button>
        <button class="scale-btn" onclick="selectScale('doubt',2,this)">2</button>
        <button class="scale-btn" onclick="selectScale('doubt',3,this)">3</button>
        <button class="scale-btn" onclick="selectScale('doubt',4,this)">4</button>
        <button class="scale-btn" onclick="selectScale('doubt',5,this)">5</button>
      </div>
    </div>
    <div class="reaction" id="reaction-5"></div>
    <button class="btn continue-btn" id="continue-5" onclick="advanceStep()">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 6: LEADER / FOLLOWER ===== -->
<div class="screen" data-step="6">
  <div class="screen-inner">
    <p class="q-label">Your Role</p>
    <h2 class="q-title">Which better describes you?</h2>
    <div class="choices" id="q-leader">
      <div class="choice" onclick="selectWithReaction('leader','leader',this)">
        <span class="ch-icon">üëë</span><span class="ch-text">A leader</span>
      </div>
      <div class="choice" onclick="selectWithReaction('leader','follower',this)">
        <span class="ch-icon">ü§ù</span><span class="ch-text">A follower</span>
      </div>
      <div class="choice" onclick="selectWithReaction('leader','both',this)">
        <span class="ch-icon">üîÄ</span><span class="ch-text">A bit of both</span>
      </div>
    </div>
    <div class="reaction" id="reaction-6"></div>
    <button class="btn continue-btn" id="continue-6" onclick="advanceStep()">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 7: QUICK DECISIONS ===== -->
<div class="screen" data-step="7">
  <div class="screen-inner">
    <p class="q-label">Decision-Making</p>
    <h2 class="q-title">"Quick decision-making is often a challenge for me."</h2>
    <div class="choices" id="q-decisions">
      <div class="choice" onclick="selectWithReaction('decisions','yes',this)">
        <span class="ch-text">Yes</span>
      </div>
      <div class="choice" onclick="selectWithReaction('decisions','no',this)">
        <span class="ch-text">No</span>
      </div>
      <div class="choice" onclick="selectWithReaction('decisions','idk',this)">
        <span class="ch-text">I don't know</span>
      </div>
    </div>
    <div class="reaction" id="reaction-7"></div>
    <button class="btn continue-btn" id="continue-7" onclick="advanceStep()">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 8: INNER STRENGTH ===== -->
<div class="screen" data-step="8">
  <div class="screen-inner">
    <p class="q-label">Inner Strength</p>
    <h2 class="q-title">"I often feel a lack of inner strength to confront challenges."</h2>
    <div class="scale-wrap">
      <div class="scale-labels"><span>Disagree</span><span>Agree</span></div>
      <div class="scale-row" id="q-strength">
        <button class="scale-btn" onclick="selectScale('strength',1,this)">1</button>
        <button class="scale-btn" onclick="selectScale('strength',2,this)">2</button>
        <button class="scale-btn" onclick="selectScale('strength',3,this)">3</button>
        <button class="scale-btn" onclick="selectScale('strength',4,this)">4</button>
        <button class="scale-btn" onclick="selectScale('strength',5,this)">5</button>
      </div>
    </div>
    <div class="reaction" id="reaction-8"></div>
    <button class="btn continue-btn" id="continue-8" onclick="advanceStep()">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 9: EXTROVERT / INTROVERT ===== -->
<div class="screen" data-step="9">
  <div class="screen-inner">
    <p class="q-label">Personality</p>
    <h2 class="q-title">Which do you consider yourself to be?</h2>
    <div class="choices" id="q-personality">
      <div class="choice" onclick="selectWithReaction('personality','extrovert',this)">
        <span class="ch-icon">üéâ</span><span class="ch-text">Extrovert</span>
      </div>
      <div class="choice" onclick="selectWithReaction('personality','introvert',this)">
        <span class="ch-icon">üìñ</span><span class="ch-text">Introvert</span>
      </div>
      <div class="choice" onclick="selectWithReaction('personality','both',this)">
        <span class="ch-icon">üåó</span><span class="ch-text">Both</span>
      </div>
    </div>
    <div class="reaction" id="reaction-9"></div>
    <button class="btn continue-btn" id="continue-9" onclick="advanceStep()">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 10: PLANNING ===== -->
<div class="screen" data-step="10">
  <div class="screen-inner">
    <p class="q-label">Your Style</p>
    <h2 class="q-title">"I prefer to plan things ahead rather than go with the flow."</h2>
    <div class="scale-wrap">
      <div class="scale-labels"><span>Disagree</span><span>Agree</span></div>
      <div class="scale-row" id="q-planning">
        <button class="scale-btn" onclick="selectScale('planning',1,this)">1</button>
        <button class="scale-btn" onclick="selectScale('planning',2,this)">2</button>
        <button class="scale-btn" onclick="selectScale('planning',3,this)">3</button>
        <button class="scale-btn" onclick="selectScale('planning',4,this)">4</button>
        <button class="scale-btn" onclick="selectScale('planning',5,this)">5</button>
      </div>
    </div>
    <div class="reaction" id="reaction-10"></div>
    <button class="btn continue-btn" id="continue-10" onclick="advanceStep()">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 11: CURIOSITY ===== -->
<div class="screen" data-step="11">
  <div class="screen-inner">
    <p class="q-label">Curiosity</p>
    <h2 class="q-title">"Learning new things energizes me."</h2>
    <div class="scale-wrap">
      <div class="scale-labels"><span>Disagree</span><span>Agree</span></div>
      <div class="scale-row" id="q-curiosity">
        <button class="scale-btn" onclick="selectScale('curiosity',1,this)">1</button>
        <button class="scale-btn" onclick="selectScale('curiosity',2,this)">2</button>
        <button class="scale-btn" onclick="selectScale('curiosity',3,this)">3</button>
        <button class="scale-btn" onclick="selectScale('curiosity',4,this)">4</button>
        <button class="scale-btn" onclick="selectScale('curiosity',5,this)">5</button>
      </div>
    </div>
    <div class="reaction" id="reaction-11"></div>
    <button class="btn continue-btn" id="continue-11" onclick="advanceStep()">Continue</button>
  </div>
</div>

<!-- ===== SCREEN 12: BOOK SELECTION ===== -->
<div class="screen" data-step="12">
  <div class="screen-inner">
    <p class="q-label">Almost Done</p>
    <h2 class="q-title">Select the books that catch your interest</h2>
    <p style="font-size:0.88rem;color:var(--text-muted);margin-top:-20px;margin-bottom:28px;">Swipe right on books you'd like to explore</p>
    <div class="book-swipe" id="book-swipe"></div>
  </div>
</div>

<!-- ===== SCREEN 13: LOADING ===== -->
<div class="screen" data-step="13">
  <div class="screen-inner">
    <h2 class="q-title" style="margin-bottom:12px;">Creating your personalized plan...</h2>
    <p class="loading-text" id="loading-text">Analyzing your responses...</p>
    <div class="loading-bar-wrap"><div class="loading-bar-fill" id="loading-fill"></div></div>
    <div class="bonus-q" id="bonus-q">
      <p style="font-size:0.95rem;font-weight:600;margin-bottom:16px;">While we're at it ‚Äî do you always finish what you started?</p>
      <div style="display:flex;gap:12px;justify-content:center;">
        <button class="btn btn-outline" style="padding:12px 32px;" onclick="answerBonus('yes')">Yes</button>
        <button class="btn btn-outline" style="padding:12px 32px;" onclick="answerBonus('no')">No</button>
      </div>
    </div>
  </div>
</div>

<!-- ===== SCREEN 14: EMAIL CAPTURE ===== -->
<div class="screen" data-step="14">
  <div class="screen-inner">
    <p class="q-label">One Last Step</p>
    <h2 class="q-title">Create your personal account to see your plan</h2>
    <div class="email-form">
      <input type="email" placeholder="Enter your email" id="email-input">
      <button class="btn" onclick="submitEmail()">Continue</button>
    </div>
    <div class="trust-badges">
      <div class="badge"><span class="b-icon">üèÜ</span>60+ Books</div>
      <div class="badge"><span class="b-icon">üéôÔ∏è</span>Voice AI</div>
      <div class="badge"><span class="b-icon">‚ö°</span>20-Min Sessions</div>
      <div class="badge"><span class="b-icon">üîí</span>Cancel Anytime</div>
    </div>
  </div>
</div>

<!-- ===== SCREEN 15: PAYWALL PRIMARY ===== -->
<div class="screen paywall" data-step="15">
  <button class="pw-close" onclick="showFallback()">‚úï</button>
  <div class="pw-timer">
    <span>20% discount reserved for</span>
    <span class="t-badge" id="pw-countdown">10:00</span>
  </div>
  <div class="screen-inner">
    <p class="q-label">Your Plan Is Ready</p>
    <h2 class="q-title">Unlock your personalized book conversations</h2>
    <div class="plan-cards">
      <div class="plan-card selected" id="plan-yearly" onclick="selectPlan('yearly')">
        <div class="pop-tag">Best Value</div>
        <div class="pc-name">Yearly</div>
        <div class="pc-price">$39<span style="font-size:1rem;font-weight:400">/mo</span></div>
        <div class="pc-period">billed yearly</div>
        <div class="pc-orig"><span class="strike">$588</span> ‚Üí $468/year</div>
        <div class="pc-daily">$1.28/day ‚Äî Save $120</div>
      </div>
      <div class="plan-card" id="plan-monthly" onclick="selectPlan('monthly')">
        <div class="pc-name">Monthly</div>
        <div class="pc-price">$47<span style="font-size:1rem;font-weight:400">/mo</span></div>
        <div class="pc-period">billed monthly</div>
        <div class="pc-orig"><span class="strike">$59</span>/month</div>
        <div class="pc-daily">$1.57/day</div>
      </div>
    </div>
    <ul class="pw-features">
      <li>2 new AI book conversations every week</li>
      <li>20-minute deep-dive voice sessions</li>
      <li>Personal book expert for every title</li>
      <li>Choose your genres and interests</li>
      <li>Access on any device, no app needed</li>
    </ul>
    <button class="btn" id="pw-cta" onclick="subscribe()" style="width:100%;max-width:400px;">Get Started ‚Äî Reach Your Goals Faster</button>
    <p style="font-size:0.78rem;color:var(--text-muted);margin-top:12px;">Cancel anytime. No questions asked.</p>
  </div>
</div>

<!-- ===== SCREEN 16: PAYWALL FALLBACK ===== -->
<div class="screen paywall" data-step="16">
  <button class="pw-close" onclick="skipToWelcome()">‚úï</button>
  <div class="screen-inner">
    <p style="font-size:2.5rem;margin-bottom:16px;">ü§ù</p>
    <h2 class="q-title">Skeptical? Try free for 7 days.</h2>
    <p style="color:var(--text-sec);font-size:1rem;margin-bottom:24px;">7-day free trial. <strong style="color:var(--text);">$0 today.</strong></p>

    <div class="plan-card selected" style="max-width:380px;margin:0 auto 28px;cursor:default;">
      <div class="pop-tag">Free Trial</div>
      <div class="pc-name">Pro ‚Äî 12 months</div>
      <div class="pc-price">$0<span style="font-size:1rem;font-weight:400"> today</span></div>
      <div class="pc-period">then $49/month billed yearly</div>
      <div class="pc-daily">Try everything free for 7 days</div>
    </div>

    <div class="trial-timeline">
      <div class="tl-item"><div class="tl-day">Today</div><div class="tl-text">Trial starts. Enjoy the entire library free for 7 days.</div></div>
      <div class="tl-item"><div class="tl-day">Day 5</div><div class="tl-text">Email reminder that your trial is ending.</div></div>
      <div class="tl-item"><div class="tl-day">Day 7</div><div class="tl-text">Subscription starts, unless you cancel.</div></div>
    </div>

    <button class="btn" onclick="subscribe()" style="width:100%;max-width:380px;">Start Free Trial</button>
    <p style="font-size:0.78rem;color:var(--text-muted);margin-top:12px;">Cancel anytime during the trial ‚Äî pay nothing.</p>

    <div class="mini-faq">
      <div class="mf-item">
        <div class="mf-q" onclick="toggleMiniFaq(this)"><span>What is an AI book conversation?</span><span class="arr">‚ñº</span></div>
        <div class="mf-a">A 20-minute voice conversation with an AI expert on a specific book. You talk out loud, it responds in real time. It explains the book's key ideas, discusses them with you, and checks your understanding.</div>
      </div>
      <div class="mf-item">
        <div class="mf-q" onclick="toggleMiniFaq(this)"><span>Do I need to read the books?</span><span class="arr">‚ñº</span></div>
        <div class="mf-a">No. The AI has studied each book deeply. It walks you through everything ‚Äî you'll understand the key ideas as if you'd read it yourself.</div>
      </div>
      <div class="mf-item">
        <div class="mf-q" onclick="toggleMiniFaq(this)"><span>What if I want to cancel?</span><span class="arr">‚ñº</span></div>
        <div class="mf-a">Cancel anytime ‚Äî no questions asked. During the free trial, you pay nothing. After that, you can cancel before your next billing cycle.</div>
      </div>
      <div class="mf-item">
        <div class="mf-q" onclick="toggleMiniFaq(this)"><span>What genres are available?</span><span class="arr">‚ñº</span></div>
        <div class="mf-a">Self-Help, Business, Philosophy, Fiction, Science, and Biography. 10 books per genre, with more being added regularly.</div>
      </div>
    </div>

    <button class="btn" onclick="subscribe()" style="width:100%;max-width:380px;margin-top:8px;">Start Free Trial</button>
  </div>
</div>

<!-- ===== SCREEN 17: WELCOME ===== -->
<div class="screen" data-step="17">
  <div class="screen-inner">
    <p style="font-size:3rem;margin-bottom:16px;">üéâ</p>
    <h2 class="q-title">Your plan is ready!</h2>
    <p style="color:var(--text-sec);margin-bottom:8px;">Based on your answers, here's what we've prepared:</p>
    <div class="welcome-plan" id="welcome-plan"></div>
    <p style="color:var(--text-muted);font-size:0.85rem;margin-top:20px;">Check your email for your first book conversation link.</p>
    <button class="btn" style="margin-top:20px;" onclick="window.location.reload()">Explore More Books</button>
  </div>
</div>

<script>
// ===== DATA =====
const REACTIONS = {
  focus: {
    big: { title: 'A visionary thinker!', text: 'Big-picture thinkers make great strategists. Our book conversations will pair your vision with actionable insights from the world\'s best authors.' },
    detail: { title: 'An analytical mind!', text: 'Detail-oriented thinkers catch what others miss. Our conversations give you both the specifics and the bigger context behind every idea.' },
    both: { title: 'Flexible thinking!', text: 'Switching between big-picture and details is a rare skill. Our book conversations are designed for exactly this kind of versatile mind.' },
  },
  goals: {
    high: { title: 'Clarity of purpose!', text: 'Knowing what you want is powerful. We\'ll help you get there faster with the right books at the right time.' },
    mid: { title: 'Open to possibilities!', text: 'You\'re exploring ‚Äî that\'s how breakthroughs happen. Our conversations will help clarify your path through the world\'s best ideas.' },
    low: { title: 'The explorer!', text: 'Many of the most successful people didn\'t have a fixed plan ‚Äî they followed curiosity. Our book library will feed yours.' },
  },
  doubt: {
    high: { title: 'Self-awareness is strength!', text: 'Recognizing self-doubt is the first step to overcoming it. We have powerful book conversations on resilience, confidence, and turning setbacks into fuel.' },
    mid: { title: 'Balanced perspective!', text: 'A healthy relationship with mistakes is rare. Our conversations will help you build on that foundation.' },
    low: { title: 'Rock-solid confidence!', text: 'That self-assurance is a real asset. Our conversations will help you channel it into even bigger challenges.' },
  },
  leader: {
    leader: { title: 'Born to lead!', text: 'Natural leaders never stop learning. Our library includes conversations with the world\'s most influential leadership thinkers ‚Äî from Covey to Carnegie.' },
    follower: { title: 'The team player!', text: 'Great collaborators drive every successful team. We\'ll strengthen your skills with insights on communication, trust, and personal growth.' },
    both: { title: 'The adaptable one!', text: 'Reject traditional labels? Smart. Our library of 60+ conversations will strengthen both your leadership and collaboration instincts.' },
  },
  decisions: {
    yes: { title: 'You\'re not alone!', text: 'It\'s normal to hesitate before making decisions, but it can limit your day-to-day life. We have book conversations specifically designed to build sharper, faster thinking.' },
    no: { title: 'Decisive and confident!', text: 'Quick decisions are a superpower. We\'ll help you make even better ones with mental models from the world\'s top thinkers.' },
    idk: { title: 'Self-reflection in action!', text: 'The fact that you\'re thinking about it shows self-awareness. Our conversations will give you frameworks for clearer, more confident thinking.' },
  },
  strength: {
    high: { title: 'Everyone faces this.', text: 'The right ideas at the right time can transform your inner resilience. That\'s exactly what our book conversations deliver ‚Äî practical strength from the world\'s wisest minds.' },
    mid: { title: 'Solid foundation!', text: 'You\'ve got a good balance. Our conversations will add new tools for handling whatever comes your way.' },
    low: { title: 'Inner fortitude!', text: 'That inner strength is impressive. We\'ll help you channel it into new frontiers with wisdom from the world\'s greatest books.' },
  },
  personality: {
    extrovert: { title: 'You\'ll love this!', text: 'Our voice conversations are like talking to a brilliant friend who read the book for you. Interactive, energizing, and always interesting.' },
    introvert: { title: 'Perfect for you!', text: 'Great news ‚Äî our conversations are private, one-on-one, at your own pace. No group settings, no pressure. Just you and your book expert.' },
    both: { title: 'Hooray for the ambivert team!', text: 'People who identify as both extroverts and introverts depending on the situation are called ambiverts ‚Äî and they need a unique approach. Our conversations adapt to your energy.' },
  },
  planning: {
    high: { title: 'The planner!', text: 'You\'ll love our weekly schedule ‚Äî 2 new book conversations delivered like clockwork. The perfect addition to your growth routine.' },
    mid: { title: 'Flexible planning!', text: 'Our weekly conversations give you structure without rigidity. Show up when it works for you.' },
    low: { title: 'Go with the flow!', text: 'Spontaneous and adaptable! Our conversations are always available whenever the mood strikes ‚Äî no schedules required.' },
  },
  curiosity: {
    high: { title: 'A curious mind!', text: 'You\'re going to love exploring ideas across 60+ books from 6 different genres. Every conversation is a new discovery.' },
    mid: { title: 'Selective curiosity!', text: 'Smart approach ‚Äî going deep on what matters. We\'ll help you find exactly the conversations that match your interests.' },
    low: { title: 'Focused and intentional!', text: 'Going deep on what matters beats surface-level exploring. We\'ll match you with books that speak directly to your goals.' },
  },
};

const BOOK_POOL = {
  productive: [
    { title: 'Atomic Habits', author: 'James Clear', sub: 'An Easy & Proven Way to Build Good Habits' },
    { title: 'Deep Work', author: 'Cal Newport', sub: 'Rules for Focused Success in a Distracted World' },
    { title: 'Getting Things Done', author: 'David Allen', sub: 'The Art of Stress-Free Productivity' },
  ],
  habits: [
    { title: 'The Power of Habit', author: 'Charles Duhigg', sub: 'Why We Do What We Do in Life and Business' },
    { title: 'Mindset', author: 'Carol Dweck', sub: 'The New Psychology of Success' },
    { title: 'Tiny Habits', author: 'BJ Fogg', sub: 'The Small Changes That Change Everything' },
  ],
  finances: [
    { title: 'Rich Dad Poor Dad', author: 'Robert Kiyosaki', sub: 'What the Rich Teach Their Kids About Money' },
    { title: 'Zero to One', author: 'Peter Thiel', sub: 'Notes on Startups, or How to Build the Future' },
    { title: 'The Psychology of Money', author: 'Morgan Housel', sub: 'Timeless Lessons on Wealth and Happiness' },
  ],
  relationships: [
    { title: 'How to Win Friends and Influence People', author: 'Dale Carnegie', sub: 'The Classic Guide to Social Skills' },
    { title: 'The 5 Love Languages', author: 'Gary Chapman', sub: 'The Secret to Love That Lasts' },
    { title: 'Crucial Conversations', author: 'Patterson, Grenny, McMillan & Switzler', sub: 'Tools for Talking When Stakes Are High' },
  ],
  wellbeing: [
    { title: 'The Power of Now', author: 'Eckhart Tolle', sub: 'A Guide to Spiritual Enlightenment' },
    { title: 'Meditations', author: 'Marcus Aurelius', sub: 'Timeless Wisdom from the Stoic Emperor' },
    { title: 'Man\'s Search for Meaning', author: 'Viktor Frankl', sub: 'Finding Purpose in the Darkest Times' },
  ],
  browsing: [
    { title: 'Sapiens', author: 'Yuval Noah Harari', sub: 'A Brief History of Humankind' },
    { title: 'The Alchemist', author: 'Paulo Coelho', sub: 'A Fable About Following Your Dream' },
    { title: 'Thinking, Fast and Slow', author: 'Daniel Kahneman', sub: 'How Two Systems Drive the Way We Think' },
  ],
};

// ===== STATE =====
let step = 0;
const answers = {};
const multiSelections = { growth: new Set() };
let bookQueue = [];
let bookIndex = 0;
const bookVotes = {};
let selectedPlan = 'yearly';
let countdownInterval = null;
let countdownSeconds = 600;

// ===== NAVIGATION =====
function goTo(s) {
  step = s;
  document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
  const target = document.querySelector(`[data-step="${s}"]`);
  if (target) target.classList.add('active');
  updateProgress();
  window.scrollTo({ top: 0, behavior: 'instant' });
}

function advanceStep() { goTo(step + 1); if (step === 12) initBookSelection(); if (step === 13) runLoading(); }

function startQuiz() { goTo(1); }

function updateProgress() {
  const bar = document.getElementById('progress-bar');
  const fill = document.getElementById('progress-fill');
  if (step >= 1 && step <= 14) {
    bar.style.display = 'block';
    fill.style.width = ((step / 14) * 100) + '%';
  } else {
    bar.style.display = 'none';
  }
}

// ===== SINGLE SELECT (auto-advance, no reaction) =====
function selectSingle(key, value, el) {
  answers[key] = value;
  el.parentElement.querySelectorAll('.choice').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  setTimeout(() => advanceStep(), 400);
}

// ===== MULTI SELECT =====
function toggleMulti(key, value, el) {
  const set = multiSelections[key];
  if (set.has(value)) { set.delete(value); el.classList.remove('selected'); }
  else { set.add(value); el.classList.add('selected'); }
  const btn = document.getElementById(key + '-continue');
  if (btn) { btn.classList.toggle('show', set.size > 0); btn.style.display = set.size > 0 ? 'inline-block' : 'none'; }
}

// ===== SELECT WITH REACTION =====
function selectWithReaction(key, value, el) {
  answers[key] = value;
  el.parentElement.querySelectorAll('.choice').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  showReaction(key, value);
}

function showReaction(key, value) {
  const stepNum = {focus:3,leader:6,decisions:7,personality:9}[key];
  const data = REACTIONS[key]?.[value];
  if (!data || !stepNum) return;
  const el = document.getElementById('reaction-' + stepNum);
  el.innerHTML = `<div class="r-title">${data.title}</div><div class="r-text">${data.text}</div>`;
  el.classList.add('show');
  const btn = document.getElementById('continue-' + stepNum);
  if (btn) { btn.classList.add('show'); btn.style.display = 'inline-block'; }
}

// ===== SCALE SELECT =====
function selectScale(key, value, el) {
  answers[key] = value;
  el.parentElement.querySelectorAll('.scale-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  const level = value >= 4 ? 'high' : value === 3 ? 'mid' : 'low';
  const stepMap = {goals:4,doubt:5,strength:8,planning:10,curiosity:11};
  const stepNum = stepMap[key];
  const data = REACTIONS[key]?.[level];
  if (data && stepNum) {
    const rEl = document.getElementById('reaction-' + stepNum);
    rEl.innerHTML = `<div class="r-title">${data.title}</div><div class="r-text">${data.text}</div>`;
    rEl.classList.add('show');
    const btn = document.getElementById('continue-' + stepNum);
    if (btn) { btn.classList.add('show'); btn.style.display = 'inline-block'; }
  }
}

// ===== BOOK SELECTION =====
function initBookSelection() {
  const growth = multiSelections.growth;
  const seen = new Set();
  bookQueue = [];
  const areas = growth.size > 0 ? [...growth] : ['browsing'];
  for (const area of areas) {
    for (const book of (BOOK_POOL[area] || [])) {
      if (!seen.has(book.title)) { seen.add(book.title); bookQueue.push(book); }
    }
  }
  // Pad to at least 5
  for (const book of BOOK_POOL.browsing) {
    if (!seen.has(book.title) && bookQueue.length < 5) { seen.add(book.title); bookQueue.push(book); }
  }
  bookQueue = bookQueue.slice(0, 9);
  bookIndex = 0;
  renderBookCard();
}

function renderBookCard() {
  const container = document.getElementById('book-swipe');
  if (bookIndex >= bookQueue.length) { advanceStep(); return; }
  const book = bookQueue[bookIndex];
  container.innerHTML = `
    <div class="book-cover">
      <div class="bc-num">Book ${bookIndex + 1} of ${bookQueue.length}</div>
      <div class="bc-title">${book.title}</div>
      <div class="bc-author">${book.author}</div>
      <div class="bc-sub">${book.sub}</div>
    </div>
    <div class="vote-row">
      <button class="vote-btn down" onclick="voteBook(false)">üëé</button>
      <button class="vote-btn up" onclick="voteBook(true)">üëç</button>
    </div>
  `;
}

function voteBook(liked) {
  bookVotes[bookQueue[bookIndex].title] = liked;
  bookIndex++;
  renderBookCard();
}

// ===== LOADING =====
let loadingDone = false;
let bonusAnswered = false;

function runLoading() {
  loadingDone = false;
  bonusAnswered = false;
  const fill = document.getElementById('loading-fill');
  const text = document.getElementById('loading-text');
  const msgs = ['Analyzing your responses...', 'Matching with our book library...', 'Selecting your genres...', 'Building your weekly plan...'];
  let i = 0;
  fill.style.width = '15%';
  const interval = setInterval(() => {
    i++;
    if (i === 1) { fill.style.width = '35%'; text.textContent = msgs[1]; }
    if (i === 2) { fill.style.width = '55%'; text.textContent = msgs[2]; document.getElementById('bonus-q').classList.add('show'); }
    if (i === 3) { fill.style.width = '75%'; text.textContent = msgs[3]; }
    if (i === 4) { fill.style.width = '100%'; text.textContent = 'Done!'; clearInterval(interval); loadingDone = true; if (bonusAnswered) setTimeout(() => advanceStep(), 600); }
  }, 1200);
}

function answerBonus(val) {
  answers.bonus = val;
  bonusAnswered = true;
  document.getElementById('bonus-q').innerHTML = '<p style="color:var(--accent);font-weight:600;">Got it! Almost there...</p>';
  if (loadingDone) setTimeout(() => advanceStep(), 600);
}

// ===== EMAIL =====
function submitEmail() {
  const input = document.getElementById('email-input');
  const btn = input.parentElement.querySelector('.btn');
  const email = input.value.trim();
  if (!email || !email.includes('@')) { input.style.borderColor = 'var(--red)'; return; }
  answers.email = email;
  btn.textContent = 'Saving...';
  btn.disabled = true;
  const likedBooks = Object.entries(bookVotes).filter(([_,v]) => v).map(([t]) => t);
  const dislikedBooks = Object.entries(bookVotes).filter(([_,v]) => !v).map(([t]) => t);
  const fields = {
    age: answers.age || '',
    interests: [...(multiSelections.growth || [])].join(', '),
    books_liked: likedBooks.join(', '),
    books_disliked: dislikedBooks.join(', '),
    focus_style: answers.focus || '',
    goal_clarity: String(answers.goals || ''),
    self_doubt: String(answers.doubt || ''),
    leader_follower: answers.leader || '',
    decision_speed: answers.decisions || '',
    inner_strength: String(answers.strength || ''),
    personality_type: answers.personality || '',
    planning_style: String(answers.planning || ''),
    curiosity_level: String(answers.curiosity || '')
  };
  // Subscribe via serverless function (creates subscriber + adds to form, API key server-side)
  fetch('/api/subscribe', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email_address: email, fields: fields })
  })
  .then(r => r.json().then(d => ({ ok: r.ok, status: r.status, data: d })))
  .then(({ ok, status, data }) => {
    if (ok) console.log('[Kit] Subscribed:', data);
    else console.error('[Kit] Error ' + status + ':', data);
  })
  .catch(e => console.error('[Kit] Network error:', e));
  // Proceed to paywall
  setTimeout(() => {
    btn.textContent = 'Continue';
    btn.disabled = false;
    goTo(15);
    startCountdown();
  }, 1000);
}

// ===== PAYWALL =====
function startCountdown() {
  countdownSeconds = 600;
  updateCountdownDisplay();
  if (countdownInterval) clearInterval(countdownInterval);
  countdownInterval = setInterval(() => {
    countdownSeconds--;
    if (countdownSeconds <= 0) { clearInterval(countdownInterval); countdownSeconds = 0; }
    updateCountdownDisplay();
  }, 1000);
}

function updateCountdownDisplay() {
  const m = Math.floor(countdownSeconds / 60);
  const s = countdownSeconds % 60;
  document.getElementById('pw-countdown').textContent = m + ':' + String(s).padStart(2, '0');
}

function selectPlan(plan) {
  selectedPlan = plan;
  document.getElementById('plan-yearly').classList.toggle('selected', plan === 'yearly');
  document.getElementById('plan-monthly').classList.toggle('selected', plan === 'monthly');
}

function showFallback() {
  if (countdownInterval) clearInterval(countdownInterval);
  goTo(16);
}

function subscribe() {
  // In production, redirect to Stripe
  const urls = {
    yearly: 'https://buy.stripe.com/5kQcN447AbWG26vf1O2880c',
    monthly: 'https://buy.stripe.com/00w8wObA24ueeTh2f22880a',
    trial: 'https://buy.stripe.com/9B6dR8bA2d0K4eDbPC2880b',
  };
  if (step === 16) { window.location.href = urls.trial; return; }
  window.location.href = urls[selectedPlan] || urls.yearly;
}

function skipToWelcome() {
  if (countdownInterval) clearInterval(countdownInterval);
  goTo(17);
  renderWelcome();
}

// ===== WELCOME =====
function renderWelcome() {
  const plan = document.getElementById('welcome-plan');
  const growth = multiSelections.growth;
  const areas = growth.size > 0 ? [...growth] : ['browsing'];
  const areaNames = {
    productive: 'Productivity & Focus',
    habits: 'Habits & Routines',
    finances: 'Finance & Career',
    relationships: 'Relationships',
    wellbeing: 'Well-being & Mindfulness',
    browsing: 'General Interest',
  };
  const likedBooks = Object.entries(bookVotes).filter(([_,v]) => v).map(([t]) => t);
  let html = `<div class="wp-item"><div class="wp-icon">üìö</div><div class="wp-text">Your genres: <strong>${areas.map(a => areaNames[a] || a).join(', ')}</strong></div></div>`;
  html += `<div class="wp-item"><div class="wp-icon">üìÖ</div><div class="wp-text"><strong>2 new books every week</strong> delivered to your inbox</div></div>`;
  if (likedBooks.length > 0) {
    html += `<div class="wp-item"><div class="wp-icon">‚≠ê</div><div class="wp-text">Starting with: <strong>${likedBooks[0]}</strong></div></div>`;
  }
  html += `<div class="wp-item"><div class="wp-icon">üéÅ</div><div class="wp-text">Your <strong>free book conversation</strong> link has been sent to your email</div></div>`;
  plan.innerHTML = html;
}

// ===== MINI FAQ =====
function toggleMiniFaq(el) {
  const a = el.nextElementSibling;
  const open = el.classList.contains('open');
  document.querySelectorAll('.mf-q').forEach(q => q.classList.remove('open'));
  document.querySelectorAll('.mf-a').forEach(a => a.classList.remove('open'));
  if (!open) { el.classList.add('open'); a.classList.add('open'); }
}
</script>

</body>
</html>
